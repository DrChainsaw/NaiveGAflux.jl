<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quick Tutorial · NaiveGAflux</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">NaiveGAflux</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Quick Tutorial</a></li><li><span class="tocitem">AutoFlux</span><ul><li><a class="tocitem" href="../../autoflux/">AutoFlux</a></li><li><a class="tocitem" href="../../autoflux/reference/reference/">AutoFlux API Reference</a></li></ul></li><li><span class="tocitem">Components</span><ul><li><a class="tocitem" href="../searchspace/">Search Spaces</a></li><li><a class="tocitem" href="../mutation/">Mutation Operations</a></li><li><a class="tocitem" href="../crossover/">Crossover Operations</a></li><li><a class="tocitem" href="../fitness/">Fitness Functions</a></li><li><a class="tocitem" href="../candidate/">Candidate Utilities</a></li><li><a class="tocitem" href="../evolution/">Evolution Strategies</a></li><li><a class="tocitem" href="../iterators/">Iterators</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../reference/searchspace/">Search Spaces</a></li><li><a class="tocitem" href="../../reference/mutation/">Mutation Operations</a></li><li><a class="tocitem" href="../../reference/crossover/">Crossover Operations</a></li><li><a class="tocitem" href="../../reference/fitness/">Fitness Functions</a></li><li><a class="tocitem" href="../../reference/candidate/">Candidate Utilities</a></li><li><a class="tocitem" href="../../reference/evolution/">Evolution Strategies</a></li><li><a class="tocitem" href="../../reference/batchsize/">Batch Size Utilities</a></li><li><a class="tocitem" href="../../reference/iterators/">Iterators</a></li><li><a class="tocitem" href="../../reference/utils/">Misc. Utilities</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Quick Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quick Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DrChainsaw/NaiveGAflux.jl/blob/master/test/examples/quicktutorial.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Quick-Tutorial"><a class="docs-heading-anchor" href="#Quick-Tutorial">Quick Tutorial</a><a id="Quick-Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Tutorial" title="Permalink"></a></h1><p>Here is a very basic example just to get a feeling for the package. We set up a simple search for number of fully connected layers and their widths.</p><pre><code class="language-julia hljs">using NaiveGAflux, Flux, Random
Random.seed!(NaiveGAflux.rng_default, 0)

nlabels = 3
ninputs = 5</code></pre><h4 id="Step-1:-Create-initial-models."><a class="docs-heading-anchor" href="#Step-1:-Create-initial-models.">Step 1: Create initial models.</a><a id="Step-1:-Create-initial-models.-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-Create-initial-models." title="Permalink"></a></h4><p>Search space: 2-4 dense layers of width 3-10.</p><pre><code class="language-julia hljs">layerspace = VertexSpace(DenseSpace(3:10, [identity, relu, elu, selu]))
initial_hidden = RepeatArchSpace(layerspace, 1:3)</code></pre><p>Output layer has fixed size and is shielded from mutation.</p><pre><code class="language-julia hljs">outlayer = VertexSpace(Shielded(), DenseSpace(nlabels, identity))
initial_searchspace = ArchSpaceChain(initial_hidden, outlayer)</code></pre><p>Sample 5 models from the initial search space and make an initial population.</p><pre><code class="language-julia hljs">samplemodel(invertex) = CompGraph(invertex, initial_searchspace(invertex))
models = [samplemodel(denseinputvertex(&quot;input&quot;, ninputs)) for _ in 1:5]
@test nvertices.(models) == [4, 3, 4, 5, 3]

population = Population(CandidateModel.(models))
@test generation(population) == 1</code></pre><h4 id="Step-2:-Set-up-fitness-function:"><a class="docs-heading-anchor" href="#Step-2:-Set-up-fitness-function:">Step 2: Set up fitness function:</a><a id="Step-2:-Set-up-fitness-function:-1"></a><a class="docs-heading-anchor-permalink" href="#Step-2:-Set-up-fitness-function:" title="Permalink"></a></h4><p>Train model for one epoch using <code>datasettrain</code>, then measure accuracy on <code>datasetvalidate</code>. We use dummy data here just to make stuff run.</p><pre><code class="language-julia hljs">onehot(y) = Flux.onehotbatch(y, 1:nlabels)
batchsize = 4
datasettrain    = [(randn(ninputs, batchsize), onehot(rand(1:nlabels, batchsize)))]
datasetvalidate = [(randn(ninputs, batchsize), onehot(rand(1:nlabels, batchsize)))]

fitnessfunction = TrainThenFitness(;
    dataiter = datasettrain,
    defaultloss = Flux.logitcrossentropy, # Will be used if not provided by the candidate
    defaultopt = ADAM(), # Same as above. State is wiped after training to prevent memory leaks
    fitstrat = AccuracyFitness(datasetvalidate) # This is what creates our fitness value after training
)</code></pre><h4 id="Step-3:-Define-how-to-search-for-new-candidates"><a class="docs-heading-anchor" href="#Step-3:-Define-how-to-search-for-new-candidates">Step 3: Define how to search for new candidates</a><a id="Step-3:-Define-how-to-search-for-new-candidates-1"></a><a class="docs-heading-anchor-permalink" href="#Step-3:-Define-how-to-search-for-new-candidates" title="Permalink"></a></h4><p>We choose to evolve the existing ones through mutation.</p><p><a href="../../reference/mutation/#NaiveGAflux.VertexMutation"><code>VertexMutation</code></a> selects valid vertices from the graph to mutate. <a href="../../reference/mutation/#NaiveGAflux.MutationProbability"><code>MutationProbability</code></a> applies mutation <code>m</code> with a probability of <code>p</code>. Lets create a short helper for brevity:</p><pre><code class="language-julia hljs">mp(m, p) = VertexMutation(MutationProbability(m, p))</code></pre><p>Change size (60% chance) and/or add a layer (40% chance) and/or remove a layer (40% chance). You might want to use lower probabilities than this.</p><pre><code class="language-julia hljs">changesize = mp(NoutMutation(-0.2, 0.2), 0.6)
addlayer = mp(AddVertexMutation(layerspace), 0.4)
remlayer = mp(RemoveVertexMutation(), 0.4)
mutation = MutationChain(changesize, remlayer, addlayer)</code></pre><p>Selection: The two best models are not changed, then create three new models by applying the mutations above to three of the five models with higher fitness giving higher probability of being selected.</p><p><a href="examples/@ref">`MapCandidate^</a> helps with the plumbing of creating new <code>CandidateModel</code>s  where <code>mutation</code> is applied to create a new model.</p><pre><code class="language-julia hljs">elites = EliteSelection(2)
mutate = SusSelection(3, EvolveCandidates(MapCandidate(mutation)))
selection = CombinedEvolution(elites, mutate)</code></pre><h4 id="Step-4:-Run-evolution"><a class="docs-heading-anchor" href="#Step-4:-Run-evolution">Step 4: Run evolution</a><a id="Step-4:-Run-evolution-1"></a><a class="docs-heading-anchor-permalink" href="#Step-4:-Run-evolution" title="Permalink"></a></h4><pre><code class="language-julia hljs">newpopulation = evolve(selection, fitnessfunction, population)
@test newpopulation != population
@test generation(newpopulation) == 2</code></pre><p>Repeat until a model with the desired fitness is found.</p><pre><code class="language-julia hljs">newnewpopulation = evolve(selection, fitnessfunction, newpopulation)
@test newnewpopulation != newpopulation
@test generation(newnewpopulation) == 3
bestfitness, bestcandnr = findmax(fitness, newnewpopulation)
@test model(newnewpopulation[bestcandnr]) isa CompGraph</code></pre><p>Maybe in a loop :)</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Introduction</a><a class="docs-footer-nextpage" href="../../autoflux/">AutoFlux »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.19 on <span class="colophon-date" title="Sunday 5 June 2022 22:28">Sunday 5 June 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
